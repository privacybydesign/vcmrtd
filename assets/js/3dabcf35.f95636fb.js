"use strict";(self.webpackChunkdmrtd_docs=self.webpackChunkdmrtd_docs||[]).push([[1516],{1480:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/CSCA-89eadb30d194607250992498f462d574.png"},7599:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>o,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"info/pki","title":"Understanding the Passport PKI Trust Chain","description":"CSCA PKI infrastructure","source":"@site/docs/info/pki.md","sourceDirName":"info","slug":"/info/pki","permalink":"/dmrtd/info/pki","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docSidebar","previous":{"title":"Passport Standards","permalink":"/dmrtd/info/standards"}}');var i=s(4848),r=s(8453);const a={},c="Understanding the Passport PKI Trust Chain",l={},d=[{value:"PKI Components Overview",id:"pki-components-overview",level:2},{value:"Masterlist and Trust Issues",id:"masterlist-and-trust-issues",level:2},{value:"Step-by-Step Validation Using OpenSSL",id:"step-by-step-validation-using-openssl",level:2},{value:"Step 1: Read EF.SOD and Inspect ASN.1 Structure",id:"step-1-read-efsod-and-inspect-asn1-structure",level:3},{value:"Step 2: Extract Document Signer Certificate (DSC)",id:"step-2-extract-document-signer-certificate-dsc",level:3},{value:"Step 3:  Unpack the Masterlist and Find the Matching CSCA",id:"step-3--unpack-the-masterlist-and-find-the-matching-csca",level:3},{value:"Step 4: Validate the DSC with the CSCA",id:"step-4-validate-the-dsc-with-the-csca",level:3},{value:"Step 5: Extract and Inspect the Signed Content",id:"step-5-extract-and-inspect-the-signed-content",level:3},{value:"Step 6: Final Signature Verification of EF.SOD",id:"step-6-final-signature-verification-of-efsod",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"understanding-the-passport-pki-trust-chain",children:"Understanding the Passport PKI Trust Chain"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"CSCA PKI infrastructure",src:s(1480).A+"",width:"871",height:"711"})}),"\n",(0,i.jsx)(n.h2,{id:"pki-components-overview",children:"PKI Components Overview"}),"\n",(0,i.jsx)(n.p,{children:"In the context of electronic Machine Readable Travel Documents (eMRTDs), the trust model is built on a PKI similar to that used in web certificates, but governed under ICAO (International Civil Aviation Organization) guidelines:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CSCA (Country Signing Certificate Authority): Each country has one or more CSCAs which issue Document Signer Certificates (DSCs)."}),"\n",(0,i.jsx)(n.li,{children:"DSC (Document Signer Certificate): Used to sign the EF.SOD, which contains hashes of data groups (e.g. face image, fingerprint)."}),"\n",(0,i.jsx)(n.li,{children:"EF.SOD (Elementary File - Security Object Document): A signed object holding hashes of ePassport content."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The trust chain is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"EF.SOD \u2194 signed by \u2192 DSC \u2194 issued by \u2192 CSCA\n"})}),"\n",(0,i.jsx)(n.p,{children:"To validate the EF.SOD:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Extract the DSC from the EF.SOD."}),"\n",(0,i.jsx)(n.li,{children:"Match the DSC against the CSCA using the Masterlist."}),"\n",(0,i.jsx)(n.li,{children:"Confirm the signature is valid and the hash digest matches the ePassport content."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"masterlist-and-trust-issues",children:"Masterlist and Trust Issues"}),"\n",(0,i.jsx)(n.p,{children:"The Masterlist is a file signed by a national authority (e.g., Netherlands), aggregating CSCAs from many countries. While the ICAO recommends this, trust issues arise because not all countries (e.g., USA) participate in signing or trusting others' masterlists."}),"\n",(0,i.jsx)(n.p,{children:"Start by downloading:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Masterlist.mls \u2013 contains ~394 CSCA certificates. (",(0,i.jsx)(n.a,{href:"https://www.npkd.nl/index.html",children:"https://www.npkd.nl/index.html"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Dutch Self-signed CSCA certificate."}),"\n",(0,i.jsx)(n.li,{children:"Dutch Link certificate (bridges certificate generations)."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"step-by-step-validation-using-openssl",children:"Step-by-Step Validation Using OpenSSL"}),"\n",(0,i.jsx)(n.p,{children:"Step-by-Step Validation Using OpenSSL"}),"\n",(0,i.jsx)(n.h3,{id:"step-1-read-efsod-and-inspect-asn1-structure",children:"Step 1: Read EF.SOD and Inspect ASN.1 Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"final hex = mrtdData.sod!.toBytes().hex();\n"})}),"\n",(0,i.jsx)(n.p,{children:"Save hex to a file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"echo [hexstring] > sod.txt\r\nxxd -r -p sod.txt > EF.SOD\n"})}),"\n",(0,i.jsx)(n.p,{children:"Parse ASN.1 structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl asn1parse -in EF.SOD -inform DER -i\n"})}),"\n",(0,i.jsx)(n.p,{children:"You will see something like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"0:d=0  hl=4 l=2659 cons: appl [ 23 ]\r\n4:d=1  hl=4 l=2655 cons:  SEQUENCE\n"})}),"\n",(0,i.jsx)(n.p,{children:"OpenSSL cannot parse [APPLICATION 23], so skip the first 4 bytes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"dd if=EF.SOD of=EF.SOD.cms bs=1 skip=4\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-extract-document-signer-certificate-dsc",children:"Step 2: Extract Document Signer Certificate (DSC)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl cms -inform DER -in EF.SOD.cms -verify -noverify -out /dev/null -certsout dsc.pem\n"})}),"\n",(0,i.jsx)(n.p,{children:"Inspect it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl x509 -in dsc.pem -text -noout\n"})}),"\n",(0,i.jsx)(n.p,{children:"Convert to binary format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl x509 -in dsc.pem -outform DER -out dsc.cer\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-3--unpack-the-masterlist-and-find-the-matching-csca",children:"Step 3:  Unpack the Masterlist and Find the Matching CSCA"}),"\n",(0,i.jsx)(n.p,{children:"Download the Masterlist and associated Dutch certificates."}),"\n",(0,i.jsx)(n.p,{children:"Use icao-ml-tools to parse the .mls:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"python3 ml_to_csca_list.py MasterList.mls output_dir/\n"})}),"\n",(0,i.jsx)(n.p,{children:"Get DSC's Issuer Serial Number from:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl asn1parse -in EF.SOD -inform DER -i\n"})}),"\n",(0,i.jsx)(n.p,{children:"Find the corresponding CSCA in the unpacked masterlist (look for the matching serial or subject)."}),"\n",(0,i.jsx)(n.p,{children:"Convert CSCA file (usually .der) to .cer:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl x509 -in input.der -inform DER -out csca.cer -outform PEM\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-validate-the-dsc-with-the-csca",children:"Step 4: Validate the DSC with the CSCA"}),"\n",(0,i.jsx)(n.p,{children:"Check if the CSCA signed the DSC:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl verify -CAfile csca.cer dsc.pem\n"})}),"\n",(0,i.jsx)(n.p,{children:"Expected output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"dsc.pem: OK\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-5-extract-and-inspect-the-signed-content",children:"Step 5: Extract and Inspect the Signed Content"}),"\n",(0,i.jsx)(n.p,{children:"This content contains hash values for each data group (DG1, DG2, etc.):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl cms -inform DER -in EF.SOD.cms -verify -noverify -out lds_content.der\n"})}),"\n",(0,i.jsx)(n.p,{children:"To inspect:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl asn1parse -in lds_content.der -inform DER -i\n"})}),"\n",(0,i.jsx)(n.p,{children:"You\u2019ll see a structure with:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"DigestAlgorithmIdentifier"}),"\n",(0,i.jsx)(n.li,{children:"DataGroupHashes"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"step-6-final-signature-verification-of-efsod",children:"Step 6: Final Signature Verification of EF.SOD"}),"\n",(0,i.jsx)(n.p,{children:"Once you trust the CSCA, verify the full EF.SOD CMS signature:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"openssl cms -inform DER -in EF.SOD.cms -CAfile csca.cer -out /dev/null -verify\n"})}),"\n",(0,i.jsx)(n.p,{children:"Expected output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"CMS Verification successful\n"})})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);